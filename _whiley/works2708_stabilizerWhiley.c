#define LIBRARY_TESTING false

#include "mattCompiler.h"
#include "mattCompiler_library.c"
#include "cf_Lib.c"

bool stabilizerTest ( void );
void stabilizerInit ( void );
void x1x_stabilizerTask ( void );
void x1x_distributePower ( Any , Any , Any , Any  );
Any x1x_limitThrust ( Any  );

bool stabilizerTest (void){
  Any a1 = Bool(true);
  Any a3 = Bool(true);
  if ( dataAsInt( a1 ) == dataAsInt( a3 ) ) { goto label0; };
  goto label1;
  label0: ;
  Any a4 = Bool(motorsTest (  ));
  Any a5 = Bool(true);
  if ( dataAsInt( a4 ) == dataAsInt( a5 ) ) { goto label2; };
  label1: ;
  Any a6 = Bool(false);
  goto label3;
  label2: ;
  a6 = Bool(true);
  label3: ;
  Any a8 = Bool(true);
  if ( dataAsInt( a6 ) == dataAsInt( a8 ) ) { goto label4; };
  goto label5;
  label4: ;
  Any a9 = Bool(imu6Test (  ));
  Any a10 = Bool(true);
  if ( dataAsInt( a9 ) == dataAsInt( a10 ) ) { goto label6; };
  label5: ;
  Any a11 = Bool(false);
  goto label7;
  label6: ;
  a11 = Bool(true);
  label7: ;
  Any a13 = Bool(true);
  if ( dataAsInt( a11 ) == dataAsInt( a13 ) ) { goto label8; };
  goto label9;
  label8: ;
  Any a14 = Bool(sensfusion6Test (  ));
  Any a15 = Bool(true);
  if ( dataAsInt( a14 ) == dataAsInt( a15 ) ) { goto label10; };
  label9: ;
  Any a16 = Bool(false);
  goto label11;
  label10: ;
  a16 = Bool(true);
  label11: ;
  Any a18 = Bool(true);
  if ( dataAsInt( a16 ) == dataAsInt( a18 ) ) { goto label12; };
  goto label13;
  label12: ;
  Any a19 = Bool(controllerTest (  ));
  Any a20 = Bool(true);
  if ( dataAsInt( a19 ) == dataAsInt( a20 ) ) { goto label14; };
  label13: ;
  Any a21 = Bool(false);
  goto label15;
  label14: ;
  a21 = Bool(true);
  label15: ;
  return a21.b;
}

void stabilizerInit (void){
  Any a0 = Bool(isStabilizerInit (  ));
  Any a1 = Bool(true);
  if ( dataAsInt( a0 ) == dataAsInt( a1 ) ) { goto label16; };
  goto label17;
  label16: ;
  label17: ;
  motorsInit (  );
  imu6Init (  );
  sensfusion6Init (  );
  controllerInit (  );
  Any a2 = Fptr( &x1x_stabilizerTask, 0 );
  Any a3 = Str("STABILIZER");
  Any a4 = Int(200);
  Any a5 = Int(0);
  Any a6 = Int(2);
  Any a7 = Int(0);
  cf_lib_xTaskCreate ( a2, a3.s, a4.i, a5.i, a6.i, a7.i );
}

void x1x_stabilizerTask (void){
  Any a1 = Real(0.0);
  Any a2 = Real(0.0);
  Any a3 = Real(0.0);
  Any *a4 = malloc(3 * sizeof(Any));
		a4[0] = a1;
		a4[1] = a2;
		a4[2] = a3;
  Any a6 = Real(0.0);
  Any a7 = Real(0.0);
  Any a8 = Real(0.0);
  Any *a9 = malloc(3 * sizeof(Any));
		a9[0] = a6;
		a9[1] = a7;
		a9[2] = a8;
  Any a11 = Real(0.0);
  Any a12 = Real(0.0);
  Any a13 = Real(0.0);
  Any *a14 = malloc(3 * sizeof(Any));
		a14[0] = a11;
		a14[1] = a12;
		a14[2] = a13;
  Any a16 = Real(0.0);
  Any a18 = Real(0.0);
  Any a20 = Real(0.0);
  Any a22 = Real(0.0);
  Any a24 = Real(0.0);
  Any a26 = Real(0.0);
  Any a28 = Real(0.0);
  Any a30 = Real(0.0);
  Any a32 = Real(0.0);
  Any a34 = Str("ANGLE");
  Any a36 = Str("ANGLE");
  Any a38 = Str("ANGLE");
  Any a40 = Int(0);
  Any a42 = Int(0);
  Any a44 = Int(0);
  Any a46 = Int(0);
  Any a48 = Int(0);
  Any a50 = Int(0);
  Any a51 = Int(3);
  cf_lib_vTaskSetApplicationTaskTag ( a50.i, a51.i );
  systemWaitStart (  );
  Any a52 = Int(cf_lib_xTaskGetTickCount (  ));
  loop_start_label18: ;
/*  goto label19;
  label19: ;
  Any a54 = Int(2);
  cf_lib_vTaskDelayUntil ( a52.i, a54.i );
  cf_lib_imu9Read ( a4, a9, a14 );
  Any *a58 = cf_lib_getGyro (  );
  a4 = a58;
  Any *a59 = cf_lib_getAcc (  );
  a9 = a59;
  Any *a60 = cf_lib_getMag (  );
  a14 = a60;*/
  Any a61 = Bool(imu6IsCalibrated (  ));
  Any a62 = Bool(true);
  if ( dataAsInt( a61 ) == dataAsInt( a62 ) ) { goto label20; };
  goto label21;
  label20: ;
/*  cf_lib_commanderGetRPY ( a22.r, a24.r, a26.r );
  Any a66 = cf_lib_getEulerYawDesired (  );
  a26 = a66;
  cf_lib_commanderGetRPYType ( a34.s, a36.s, a38.s );
  Any a70 = cf_lib_getRollType (  );
  a34 = a70;
  Any a71 = cf_lib_getPitchType (  );
  a36 = a71;
  Any a72 = cf_lib_getYawType (  );
  a38 = a72;*/
  Any a74 = Int(1);
  Any a75 = wyce_add( a48, a74);
  a48 = a75;
  Any a77 = Int(2);
  if ( dataAsInt( a75 ) < dataAsInt( a77 ) ) { goto label22; };
/*  Any a79 = Real(1.0);
  Any a80 = Real(500.0);
  Any a81 = Real(2.0);
  Any a82 = wyce_div( a80, a81);
  Any a83 = wyce_div( a79, a82);
  Any a85 = Int(0);
  Any a86 = a58[a85.i];
  Any a88 = Int(1);
  Any a89 = a58[a88.i];
  Any a91 = Int(2);
  Any a92 = a58[a91.i];
  Any a94 = Int(0);
  Any a95 = a59[a94.i];
  Any a97 = Int(1);
  Any a98 = a59[a97.i];
  Any a100 = Int(2);
  Any a101 = a59[a100.i];
  cf_lib_sensfusion6UpdateQ ( a86.r, a89.r, a92.r, a95.r, a98.r, a101.r, a83.r );
  cf_lib_sensfusion6GetEulerRPY ( a16.r, a18.r, a20.r );
  Any a106 = cf_lib_getEulerRollActual (  );
  a16 = a106;
  Any a107 = cf_lib_getEulerPitchActual (  );
  a18 = a107;
  Any a108 = cf_lib_getEulerYawActual (  );
  a20 = a108;
  Any a115 = wyce_neg(a66);
  cf_lib_controllerCorrectAttitudePID ( a16.r, a18.r, a20.r, a22.r, a24.r, a115.r, a28.r, a30.r, a32.r );
  Any a119 = cf_lib_getRollRateDesired (  );
  a28 = a119;
  Any a120 = cf_lib_getPitchRateDesired (  );
  a30 = a120;
  Any a121 = Int(0);
  a48 = a121;*/
  label22: ;
/*  Any a123 = wyce_neg(a66);
  a32 = a123;
  Any a125 = Int(0);
  Any a126 = a58[a125.i];
  Any a128 = Int(1);
  Any a129 = a58[a128.i];
  Any a130 = wyce_neg(a129);
  Any a132 = Int(2);
  Any a133 = a58[a132.i];
  cf_lib_controllerCorrectRatePID ( a126.r, a130.r, a133.r, a28.r, a30.r, a32.r );
  cf_lib_controllerGetActuatorOutput ( a42.i, a44.i, a46.i );
  Any a140 = Int(cf_lib_getActuatorRoll (  ));
  a42 = a140;
  Any a141 = Int(cf_lib_getActuatorPitch (  ));
  a44 = a141;
  Any a142 = Int(cf_lib_getActuatorYaw (  ));
  a46 = a142;
  Any a143 = Int(cf_lib_commanderGetThrust ( a40.i ));
  a40 = a143;
  Any a146 = Int(0);
  if ( dataAsInt( a143 ) <= dataAsInt( a146 ) ) { goto label23; };
  Any a151 = wyce_neg(a142);
  x1x_distributePower ( a40, a42, a44, a151 );
  goto label21;
  label23: ;
  Any a152 = Int(0);
  Any a153 = Int(0);
  Any a154 = Int(0);
  Any a155 = Int(0);
  x1x_distributePower ( a152, a153, a154, a155 );
  controllerResetAllPID (  );*/
  label21: ;
  goto loop_start_label18;
//  label18: ;
}

void x1x_distributePower ( Any a0, Any a1, Any a2, Any a3 ){
  Any a8 = wyce_add( a0, a2);
  Any a10 = wyce_add( a8, a3);
  Any a5 = x1x_limitThrust ( a10 );
  Any a15 = wyce_sub( a0, a1);
  Any a17 = wyce_sub( a15, a3);
  Any a12 = x1x_limitThrust ( a17 );
  Any a22 = wyce_sub( a0, a2);
  Any a24 = wyce_add( a22, a3);
  Any a19 = x1x_limitThrust ( a24 );
  Any a29 = wyce_add( a0, a1);
  Any a31 = wyce_sub( a29, a3);
  Any a26 = x1x_limitThrust ( a31 );
  Any a32 = Int(0);
  cf_lib_motorsSetRatio ( a32.i, a5.i );
  Any a34 = Int(1);
  cf_lib_motorsSetRatio ( a34.i, a12.i );
  Any a36 = Int(2);
  cf_lib_motorsSetRatio ( a36.i, a19.i );
  Any a38 = Int(3);
  cf_lib_motorsSetRatio ( a38.i, a26.i );
}

Any x1x_limitThrust ( Any a0 ){
  Any a4 = Int(65535);
  if ( dataAsInt( a0 ) <= dataAsInt( a4 ) ) { goto label24; };
  a0 = a4;
  goto label25;
  label24: ;
  Any a9 = Int(0);
  if ( dataAsInt( a0 ) >= dataAsInt( a9 ) ) { goto label25; };
  Any a10 = Int(0);
  a0 = a10;
  label25: ;
  return a0;
}

